/* =================================================================================================
   CSS Variables & Theme System
   ================================================================================================= */
:root {
  /* Core Action & Brand Colors */
  --primary-color: #000000;
  --primary-hover: #B6B09F;
  --secondary-color: #B6B09F;
  --accent-color: #EAE4D5;

  /* Semantic Colors (Fallback - consider adding dedicated colors) */
  --success-color: #000000;
  --error-color: #000000;
  --warning-color: #000000;

  /* Unchanged Variables */
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  --spacing-2xl: 3rem;
  
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-base: 1rem;
  --font-size-lg: 1.125rem;
  --font-size-xl: 1.25rem;
  --font-size-2xl: 1.5rem;
  --font-size-3xl: 1.875rem;
  
  --transition: all 0.2s ease-in-out;
  --transition-slow: all 0.3s ease-in-out;
}

/* 
==============================================
LIGHT THEME
- Background: Light Gray (#F2F2F2)
- Text: Black (#000000)
==============================================
*/
[data-theme="light"] {
  --bg-primary: #F2F2F2;
  --bg-secondary: #FFFFFF;     /* Pure white for cards/elevated surfaces */
  --bg-tertiary: #EAE4D5;     /* Warm beige for subtle accents */
  --bg-quaternary: #EAE4D5;
  
  --text-primary: #000000;
  --text-secondary: #5c5c5c;  /* Using a generic gray for better secondary text */
  --text-muted: #B6B09F;
  --text-inverse: #F2F2F2;    /* Light text for use on black components (e.g. buttons) */
  --text-highlight: #000000;
  
  --border-color: #EAE4D5;
  --border-hover: #B6B09F;
  --border-focus: #000000;
  
  --highlight-bg: rgba(182, 176, 159, 0.2);
  --compulsory-bg: rgba(182, 176, 159, 0.1);
  --compulsory-border: rgba(182, 176, 159, 0.3);

  /* Standard dark shadows for depth */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.07);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.12), 0 4px 6px -2px rgba(0, 0, 0, 0.08);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.06);
}

/* 
==============================================
DARK THEME
- Background: Black (#000000)
- Text: Light Gray (#F2F2F2)
==============================================
*/
[data-theme="dark"] {
  --bg-primary: #000000;
  --bg-secondary: #1a1a1a;     /* A very dark gray for secondary surfaces */
  --bg-tertiary: #B6B09F;      /* Mid-tone for accented components (e.g., sidebars) */
  --bg-quaternary: #EAE4D5;    /* Lightest non-white for other accents */

  --text-primary: #F2F2F2;
  --text-secondary: #B6B09F;
  --text-muted: #8a8475;      /* Darkened mid-tone for muted text */
  --text-inverse: #000000;    /* Black text for use on light components */
  --text-highlight: #EAE4D5;  /* Use warm beige as the highlight color */

  --border-color: #B6B09F;
  --border-hover: #EAE4D5;
  --border-focus: #EAE4D5;

  --highlight-bg: rgba(234, 228, 213, 0.1); /* Transparent warm beige */
  --compulsory-bg: rgba(234, 228, 213, 0.05);
  --compulsory-border: rgba(234, 228, 213, 0.2);

  /* Shadows in dark mode are often subtle glows or non-existent. */
  --shadow-sm: 0 1px 2px 0 rgba(242, 242, 242, 0.03);
  --shadow-md: 0 4px 8px -1px rgba(242, 242, 242, 0.05);
  --shadow-lg: 0 10px 15px -3px rgba(242, 242, 242, 0.05);
  --shadow-xl: 0 20px 25px -5px rgba(242, 242, 242, 0.06);

  /* --- ADD OR OVERRIDE SEMANTIC ACTION COLORS FOR DARK THEME --- */
  --primary-color: #F2F2F2;       /* Light background for primary buttons */
  --primary-hover: #EAE4D5;       /* Slightly darker for hover state */
  --secondary-color: #dfe0d1;     /* Matches your accent/tertiary */
  --accent-color: #EAE4D5;        /* Accent for gradients, etc. */
  --success-color: #ffffff;       /* Using white for success backgrounds in dark mode */
  --error-color: #ef4444;         /* Red for error */
  --warning-color: #f59e0b;       /* Yellow for warning */

  /* VISIBILITY FIX: Ensure high contrast on mid-tone tertiary backgrounds */
  .btn-secondary,
  .download-btn,
  .header-btn:not(.active),
  .form-section:not(.compulsory-section) h3 {
    color: var(--text-inverse); /* Use black text on the beige backgrounds */
  }
}


/* =================================================================================================
   Base Styles
   ================================================================================================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--bg-primary); /* Use primary BG for body */
  transition: var(--transition);
  overflow: hidden; /* Prevent body scroll */
}

/* =================================================================================================
   Layout
   ================================================================================================= */
.storyteller-app {
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.app-header {
  background: var(--bg-secondary);
  color: var(--text-primary);
  padding: var(--spacing-sm) var(--spacing-xl);
  box-shadow: var(--shadow-md);
  position: sticky;
  top: 0;
  z-index: 100;
  flex-shrink: 0;
  border-bottom: 1px solid var(--border-color);
}

.app-main {
  flex: 1;
  display: flex;
  width: 100%; /* Occupy full width */
  gap: var(--spacing-xl);
  padding: var(--spacing-xl);
  height: calc(100vh - 74px); /* Full height minus header */
  overflow: hidden;
}

/* =================================================================================================
   Header
   ================================================================================================= */
.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%; /* Occupy full width */
}

.app-header h1 {
  font-size: var(--font-size-2xl);
  font-weight: 700;
  margin: 0;
  color: var(--text-primary);
}

.header-actions {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.header-btn {
  flex: 1 1 0;        /* Each button takes equal width */
  min-width: 0;       /* Prevents overflow if text is long */
  max-width: none;    /* Removes any max-width restriction */
  width: auto;        /* Let flexbox control the width */
  background: var(--bg-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: var(--transition);
  font-size: var(--font-size-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  font-weight: 500;
  
  height: 40px;
  padding: var(--spacing-sm) var(--spacing-md);
}

.header-btn:hover {
  background: var(--border-color);
  border-color: var(--border-hover);
}

.header-btn.active {
  background: var(--primary-color);
  color: var(--text-inverse);
  border-color: var(--primary-color);
}

.header-btn.theme-toggle-btn {
  min-width: 40px; /* Square button */
}

.mobile-nav-toggle-btn {
  display: none; /* Hidden on desktop */
  background: none;
  border: none;
  font-size: var(--font-size-2xl);
  cursor: pointer;
  color: var(--text-secondary);
  padding: var(--spacing-xs);
  border-radius: var(--radius-sm);
}

/* =================================================================================================
   Mobile Nav Sidebar
   ================================================================================================= */
.nav-sidebar {
  position: fixed;
  top: 0;
  right: -300px; /* Start off-screen */
  width:180px;
  height: 100vh;
  background: var(--bg-secondary);
  z-index: 1000;
  transition: transform 0.3s ease-in-out;
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
  border-left: 1px solid var(--border-color);
  padding: var(--spacing-xl);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

.nav-sidebar.open {
  transform: translateX(-300px);
}

.nav-sidebar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: var(--spacing-md);
}

.nav-sidebar-header h3 {
  color: var(--text-primary);
}

.nav-sidebar .nav-group {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.nav-sidebar .nav-btn {
  width: 100%;
  justify-content: flex-center;
}

/* =================================================================================================
   Sidebar (Story Settings)
   ================================================================================================= */
.desktop-sidebar {
  width: 400px;
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-color);
  height: 100%;
  display: flex;
  flex-direction: column; /* For sticky actions */
  flex-shrink: 0;
}

.sidebar-actions {
  position: sticky;
  top: 0;
  background: var(--bg-primary);
  padding: var(--spacing-md);
  border-bottom: 1px solid var(--border-color);
  z-index: 10;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  box-shadow: var(--shadow-sm);
}

.story-form {
  overflow-y: auto; /* Only this part scrolls */
  flex: 1;
}

/* =================================================================================================
   Content Area
   ================================================================================================= */
.content-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

/* Hide welcome/display on mobile if form is shown */
.mobile-form-container {
  display: none;
  height: 100%;
  overflow-y: auto;
}

.mobile-form-container .sidebar-actions {
  position: sticky;
  top: 0;
}

/* =================================================================================================
   Form Components
   ================================================================================================= */
.form-sections {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  padding: var(--spacing-lg);
}

.form-section {
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  overflow: hidden;
  background: var(--bg-primary);
}

.form-section.compulsory-section {
  background: var(--compulsory-bg);
  border-color: var(--compulsory-border);
  border-width: 2px;
  box-shadow: var(--shadow-md);
}

.form-section h3 {
  background: var(--bg-tertiary);
  padding: var(--spacing-sm) var(--spacing-md);
  margin: 0;
  font-size: var(--font-size-base);
  color: var(--text-primary);
  border-bottom: 1px solid var(--border-color);
}

.compulsory-section h3 {
  background: var(--success-color);
  color: var(--text-inverse);
  border-bottom-color: var(--compulsory-border);
}

.form-grid {
  padding: var(--spacing-md);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.form-grid.compact {
  gap: var(--spacing-sm);
}

.form-grid.compact .form-group {
  gap: calc(var(--spacing-xs) / 2);
}

.form-grid.compact .form-group label {
  font-size: var(--font-size-xs);
  margin-bottom: calc(var(--spacing-xs) / 2);
}

.form-grid.compact .form-group input,
.form-grid.compact .form-group select,
.form-grid.compact .form-group textarea {
  padding: var(--spacing-sm);
  font-size: var(--font-size-sm);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.form-group label {
  font-weight: 600;
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.required {
  color: var(--error-color);
  font-weight: bold;
}

.form-group input,
.form-group select,
.form-group textarea {
  padding: var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  font-size: var(--font-size-base);
  transition: var(--transition);
  background: var(--bg-primary);
  color: var(--text-primary);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
  color: var(--text-muted);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--border-focus);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.form-group textarea {
  resize: vertical;
  min-height: 80px;
}

/* =================================================================================================
   Button Components
   ================================================================================================= */
.btn-primary,
.btn-secondary {
  padding: var(--spacing-md) var(--spacing-lg);
  border-radius: var(--radius-md);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  font-size: var(--font-size-base);
  min-height: 48px;
  width: 100%; /* Make buttons full-width in actions panel */
}

.btn-primary {
  background: var(--primary-color);
  color: var(--text-inverse);
}

.btn-primary:hover:not(:disabled) {
  background: var(--primary-hover);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.btn-primary:disabled {
  background: var(--text-muted);
  cursor: not-allowed;
  transform: none;
}

.btn-secondary {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

.btn-secondary:hover:not(:disabled) {
  background: var(--border-color);
  transform: translateY(-1px);
}

.btn-secondary:disabled {
  background: var(--bg-tertiary);
  color: var(--text-muted);
  cursor: not-allowed;
}

.new-story-btn {
  background: var(--primary-color);
  border-color: var(--secondary-color);
  color: var(--text-inverse);
}
.new-story-btn:hover {
  background: var(--accent-color);
  border-color: var(--accent-color);
  /* Lighter beige backgrounds in both themes need dark text for contrast */
  color: #000000;
}

/* =================================================================================================
   Full Height Story Display
   ================================================================================================= */

/* FIX PART 1: ADD THIS NEW RULE to make the container flexible */
.story-display-container {
  display: flex;
  flex-direction: column;
  flex: 1; /* This makes the container take up all available vertical space */
  min-height: 0; /* Prevents flexbox overflow issues in some browsers */
}

.story-display {
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  overflow: hidden;
  border: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  height: 100%; /* This will now work correctly as its parent has a defined height */
  flex: 1;
}

.story-display-placeholder,
.centered-feedback {
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-color);
  padding: var(--spacing-2xl);
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-lg);
  justify-content: center;
  height: 100%; /* Full height */
  flex: 1;
}

.welcome-content h2 {
  color: var(--text-primary);
  margin-bottom: var(--spacing-md);
}

.welcome-content p {
  color: var(--text-secondary);
  margin-bottom: var(--spacing-lg);
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-lg);
  margin-top: var(--spacing-xl);
}

.feature {
  text-align: center;
  padding: var(--spacing-lg);
  border-radius: var(--radius-md);
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
}

.feature-icon {
  font-size: var(--font-size-3xl);
  display: block;
  margin-bottom: var(--spacing-md);
}

.feature h3 {
  margin-bottom: var(--spacing-sm);
  color: var(--text-primary);
}

.feature p {
  color: var(--text-secondary);
  font-size: var(--font-size-sm);
}

.loading-progress {
  width: 100%;
  max-width: 300px;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
  border-radius: var(--radius-sm);
  transition: width 0.3s ease;
}

.story-header {
  padding: var(--spacing-xl);
  border-bottom: 1px solid var(--border-color);
  background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
}

.story-header.compact {
  padding: var(--spacing-md) var(--spacing-lg);
  flex-shrink: 0;
}

.story-header h2 {
  margin-bottom: var(--spacing-md);
  color: var(--text-primary);
  font-size: var(--font-size-2xl);
}

.story-header.compact h2 {
  margin-bottom: var(--spacing-sm);
  font-size: var(--font-size-xl);
}

.story-meta {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-md);
  align-items: center;
}

.story-header.compact .story-meta {
  gap: var(--spacing-sm);
}

/* =================================================================================================
   Story Header Layout
   ================================================================================================= */
.story-title-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  gap: var(--spacing-md);
}

.story-title-row h2 {
  margin: 0;
  flex: 1;
  min-width: 0; /* Allow text to truncate if needed */
}

.story-meta-inline {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  flex-shrink: 0;
}

.story-meta-inline .genre-badge {
  font-size: var(--font-size-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
}

.story-meta-inline .word-count,
.story-meta-inline .voice-info {
  font-size: var(--font-size-xs);
  color: var(--text-secondary);
  white-space: nowrap;
}

.genre-badge {
  background: var(--primary-color);
  color: var(--text-inverse);
  padding: var(--spacing-xs) var(--spacing-md);
  border-radius: var(--radius-xl);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.genre-badge.small {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--font-size-xs);
}

.word-count,
.voice-info {
  color: var(--text-secondary);
  font-size: var(--font-size-sm);
}

/* =================================================================================================
   Audio Player Components
   ================================================================================================= */
.audio-player-container {
  padding: var(--spacing-xl);
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-secondary);
}

.audio-player-container.compact {
  padding: var(--spacing-md) var(--spacing-lg);
  flex-shrink: 0;
}

.custom-audio-player {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  background: var(--bg-primary);
  padding: var(--spacing-md);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-color);
}

.custom-audio-player.compact {
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  border-radius: var(--radius-md);
}

.play-pause-btn {
  background: var(--primary-color);
  color: var(--text-inverse);
  border: none;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-lg);
  transition: var(--transition);
  flex-shrink: 0;
}

.play-pause-btn.compact {
  width: 36px;
  height: 36px;
  font-size: var(--font-size-base);
}

.play-pause-btn:hover {
  background: var(--primary-hover);
  transform: scale(1.05);
}

.audio-progress-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.audio-time-info {
  display: flex;
  justify-content: space-between;
  font-size: var(--font-size-xs);
  color: var(--text-muted);
  margin-bottom: var(--spacing-xs);
}

.current-time,
.total-time {
  font-weight: 500;
}

.audio-progress-bar {
  width: 100%;
  height: 8px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  overflow: hidden;
  position: relative;
  border: 1px solid var(--border-color);
}

.audio-progress-bar.clickable {
  cursor: pointer;
}

.audio-progress-bar.clickable:hover {
  height: 10px;
  transition: height 0.2s ease;
}

.audio-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
  border-radius: var(--radius-sm);
  transition: width 0.1s ease;
}

.progress-text {
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  text-align: center;
  margin-top: var(--spacing-xs);
}

.download-btn {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  width: 40px;
  height: 40px;
  border-radius: var(--radius-md);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  transition: var(--transition);
  flex-shrink: 0;
}

.download-btn.compact {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
}

.download-btn:hover {
  background: var(--border-color);
  transform: translateY(-1px);
}

/* =================================================================================================
   Story Content Full Height
   ================================================================================================= */
.story-content {
  padding: var(--spacing-xl);
}

/* FIX PART 2: MODIFY THIS RULE for robust flexbox behavior */
.story-content.scrollable {
  flex: 1;
  overflow-y: auto; /* Only story text scrolls */
  padding: var(--spacing-lg);
  background: var(--bg-primary);
  min-height: 0; /* This prevents the content from stretching its flex parent */
}

.story-text {
  font-size: var(--font-size-lg);
  line-height: 1.8;
  color: var(--text-primary);
  text-align: justify;
  word-spacing: normal;
  white-space: normal;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.highlighted-text {
  background: var(--highlight-bg);
  padding: 0;
  margin: 0;
  border: none;
  border-radius: 0;
  font-weight: inherit;
  font-size: inherit;
  line-height: inherit;
  transition: none;
  animation: none;
  transform: none;
  box-shadow: none;
  display: inline;
}

.story-text span {
  white-space: normal;
  margin: 0;
  padding: 0;
}

/* =================================================================================================
   History Components - Compact Header
   ================================================================================================= */
.history-container {
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-color);
  overflow: hidden;
  height: 100%; /* Full height */
  display: flex;
  flex-direction: column;
}

.history-header {
  padding: var(--spacing-sm) var(--spacing-xl); /* Reduced vertical padding */
  border-bottom: 1px solid var(--border-color);
  background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
  flex-shrink: 0;
}

.history-header h2 {
  margin-bottom: var(--spacing-xs); /* Smaller margin */
  color: var(--text-primary);
  font-size: var(--font-size-lg);   /* Slightly smaller font */
  line-height: 1.2;
}

.history-header p {
  color: var(--text-secondary);
  margin: 0;
  font-size: var(--font-size-sm);   /* Smaller font */
  line-height: 1.2;
}

.history-grid {
  padding: var(--spacing-xl);
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: var(--spacing-lg);
  overflow-y: auto; /* Only history grid scrolls */
  flex: 1;
}

.history-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--spacing-lg);
  transition: var(--transition);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.history-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  border-color: var(--border-hover);
}

.history-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: var(--spacing-md);
}

.history-card h3 {
  margin: 0;
  color: var(--text-primary);
  font-size: var(--font-size-lg);
  flex: 1;
}

.history-preview {
  color: var(--text-secondary);
  line-height: 1.6;
  margin: 0;
  flex: 1;
}

.history-meta {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-md);
  font-size: var(--font-size-sm);
  color: var(--text-muted);
}

.history-actions {
  display: flex;
  gap: var(--spacing-sm);
  margin-top: auto;
}

.history-actions .btn-primary,
.history-actions .btn-secondary {
  flex: 1;
  padding: var(--spacing-sm) var(--spacing-md);
  font-size: var(--font-size-sm);
  min-height: 36px;
}

.empty-state h2 {
  color: var(--text-primary);
  margin-bottom: var(--spacing-md);
}

.empty-state p {
  color: var(--text-secondary);
  margin-bottom: var(--spacing-lg);
}

/* Responsive: Even more compact on mobile */
@media (max-width: 768px) {
  .history-header {
    padding: var(--spacing-xs) var(--spacing-md); /* Even smaller on mobile */
  }
  .history-header h2 {
    font-size: var(--font-size-base);
    margin-bottom: var(--spacing-xs);
  }
  .history-header p {
    font-size: var(--font-size-xs);
  }
}

/* =================================================================================================
   Misc & Overrides
   ================================================================================================= */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
}

.error-banner {
  background: var(--error-color);
  color: var(--text-inverse);
  padding: var(--spacing-md) var(--spacing-lg);
  border-radius: var(--radius-md);
  margin-bottom: var(--spacing-md);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  border: 1px solid rgba(239, 68, 68, 0.3);
  flex-shrink: 0;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--text-muted);
  border-top: 2px solid var(--text-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.btn-primary .spinner, .new-story-btn .spinner {
  border-color: rgba(255, 255, 255, 0.5);
  border-top-color: #fff;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* =================================================================================================
   Responsive Design
   ================================================================================================= */
@media (max-width: 1024px) {
  .app-main {
    padding: var(--spacing-md);
    gap: var(--spacing-md);
  }
  .desktop-sidebar {
    width: 350px;
  }
}

@media (max-width: 768px) {
  .app-header {
    padding: var(--spacing-md);
  }
  
  .app-header h1 {
    font-size: var(--font-size-xl);
  }
  
  .app-main {
    flex-direction: column;
    padding: var(--spacing-md); /* Increased padding for mobile main */
    height: calc(100vh - 70px); /* Adjust for smaller header */
  }

  /* --- Mobile Header --- */
  .header-actions {
    display: none; /* Hide desktop actions */
  }
  .mobile-nav-toggle-btn {
    display: flex; /* Show hamburger menu */
  }

  /* --- Mobile Layout --- */
  .desktop-sidebar {
    display: none;
  }
  .mobile-form-container {
    display: block; /* Show form in main content area */
  }
  .story-display-container.hidden-on-mobile {
    display: none; /* Hide display area if form is shown */
  }

  /* --- Mobile Story View Height Reduction --- */
  .story-header.compact {
    padding: var(--spacing-sm) var(--spacing-md);
  }
  .story-header.compact h2 {
    font-size: var(--font-size-lg);
  }
  .audio-player-container.compact {
    padding: var(--spacing-sm) var(--spacing-md);
  }
  .custom-audio-player.compact {
    gap: var(--spacing-xs);
  }
  .story-title-row {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-sm);
  }

  .history-grid {
    grid-template-columns: 1fr;
    padding: var(--spacing-lg);
  }
  .history-actions {
    flex-direction: column;
  }
}

@media (max-width: 480px) {
  .app-main {
    padding: var(--spacing-sm);
  }
  .header-btn {
    min-width: 60px;
    height: 32px;
    font-size: var(--font-size-xs);
    padding: var(--spacing-xs);
  }
}

/* =================================================================================================
   Accessibility & Print Styles
   ================================================================================================= */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible, a:focus-visible {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
}

@media print {
  .app-header, .desktop-sidebar, .nav-sidebar, .audio-player-container, .history-actions {
    display: none !important;
  }
}

/* =================================================================================================
   Delete Button Styles
   ================================================================================================= */
.btn-delete {
  background: var(--error-color);
  color: var(--text-inverse);
  border: 1px solid var(--error-color);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--radius-md);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  font-size: var(--font-size-sm);
  min-height: 36px;
}
.btn-delete:hover {
  background: #dc2626;
  border-color: #dc2626;
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

/* =================================================================================================
   Toast Notification Styles
   ================================================================================================= */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1001;
  min-width: 300px;
  max-width: 500px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-xl);
  animation: slideInRight 0.3s ease-out;
}
.toast-success { background: var(--success-color); color: var(--text-inverse); }
.toast-error { background: var(--error-color); color: var(--text-inverse); }
.toast-info { background: var(--primary-color); color: var(--text-inverse); }
.toast-content { display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-md) var(--spacing-lg); }
.toast-icon { font-size: var(--font-size-lg); flex-shrink: 0; }
.toast-message { flex: 1; font-weight: 500; }
.toast-close { background: none; border: none; color: var(--text-inverse); font-size: var(--font-size-xl); cursor: pointer; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: var(--transition); flex-shrink: 0; }
.toast-close:hover { background: rgba(255, 255, 255, 0.2); }
@keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@media (max-width: 768px) { .toast { top: 10px; right: 10px; left: 10px; min-width: auto; } }

/* =================================================================================================
   Auth Page Styles - Modern, Interactive Design
   ================================================================================================= */
:root { 
  --auth-primary: #6366f1; --auth-primary-hover: #5855eb; --auth-primary-light: rgba(99, 102, 241, 0.1); 
  --auth-secondary: #64748b; --auth-success: var(--auth-primary); --auth-error: #ef4444; --auth-warning: #f59e0b; 
  --auth-bg-primary: #ffffff; --auth-bg-secondary: #f8fafc; --auth-bg-tertiary: #f1f5f9; 
  --auth-text-primary: #1e293b; --auth-text-secondary: #64748b; --auth-text-muted: #94a3b8; 
  --auth-border: #e2e8f0; --auth-border-focus: #6366f1; 
  --auth-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05); 
  --auth-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
  --auth-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
  --auth-shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); 
  --auth-radius-sm: 0.375rem; --auth-radius-md: 0.5rem; --auth-radius-lg: 0.75rem; --auth-radius-xl: 1rem; 
  --auth-spacing-xs: 0.25rem; --auth-spacing-sm: 0.5rem; --auth-spacing-md: 1rem; --auth-spacing-lg: 1.5rem; 
  --auth-spacing-xl: 2rem; --auth-spacing-2xl: 3rem; --auth-transition: all 0.2s ease-in-out; 
}

[data-theme="dark"] { 
  --auth-bg-primary: #1e293b; --auth-bg-secondary: #0f172a; --auth-bg-tertiary: #334155; 
  --auth-text-primary: #f1f5f9; --auth-text-secondary: #cbd5e1; --auth-text-muted: #64748b; 
  --auth-border: #334155; 
}

.auth-wrapper { min-height: 100vh; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; padding: var(--auth-spacing-md); }
.auth-background { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: -2; }
.auth-background-pattern { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.1) 0%, transparent 50%); background-size: 100px 100px; animation: float 20s ease-in-out infinite; z-index: -1; }
.auth-background-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.1); backdrop-filter: blur(1px); z-index: -1; }
@keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 33% { transform: translateY(-10px) rotate(1deg); } 66% { transform: translateY(5px) rotate(-1deg); } }
.auth-content { position: relative; z-index: 1; width: 100%; max-width: 420px; margin: 0 auto; }
.auth-form-container { background: var(--auth-bg-primary); border-radius: var(--auth-radius-xl); box-shadow: var(--auth-shadow-xl); border: 1px solid var(--auth-border); backdrop-filter: blur(10px); animation: slideUp 0.5s ease-out; overflow: hidden; }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.auth-container { padding: var(--auth-spacing-2xl); }
.auth-header { text-align: center; margin-bottom: var(--auth-spacing-xl); }
.auth-logo { display: flex; align-items: center; justify-content: center; gap: var(--auth-spacing-sm); margin-bottom: var(--auth-spacing-lg); }
.auth-logo-icon { font-size: 2.5rem; background: linear-gradient(135deg, var(--auth-primary), var(--auth-primary-hover)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: pulse 2s ease-in-out infinite; }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
.auth-app-title { font-size: 1.5rem; font-weight: 700; color: var(--auth-primary); margin: 0; }
.auth-header h2 { font-size: 1.875rem; font-weight: 700; color: var(--auth-text-primary); margin: 0 0 var(--auth-spacing-sm) 0; }
.auth-header p { color: var(--auth-text-secondary); margin: 0; font-size: 0.95rem; }
.auth-form { display: flex; flex-direction: column; gap: var(--auth-spacing-lg); margin-bottom: var(--auth-spacing-xl); }
.auth-input-group { display: flex; flex-direction: column; gap: var(--auth-spacing-xs); }
.auth-input-wrapper { position: relative; display: flex; align-items: center; background: var(--auth-bg-secondary); border: 2px solid var(--auth-border); border-radius: var(--auth-radius-lg); transition: var(--auth-transition); overflow: hidden; }
.auth-input-wrapper:focus-within { border-color: var(--auth-border-focus); box-shadow: 0 0 0 3px var(--auth-primary-light); background: var(--auth-bg-primary); }
.auth-input-wrapper.error { border-color: var(--auth-error); box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1); }
.auth-input-wrapper.readonly { background: var(--auth-bg-tertiary); border-color: var(--auth-border); opacity: 0.7; }
.auth-input-icon { padding: 0 var(--auth-spacing-md); font-size: 1.125rem; color: var(--auth-text-muted); flex-shrink: 0; }
.auth-input { flex: 1; padding: var(--auth-spacing-lg); border: none; background: transparent; font-size: 1rem; color: var(--auth-text-primary); outline: none; transition: var(--auth-transition); }
.auth-input.with-icon { padding-left: 0; }
.auth-input::placeholder { color: var(--auth-text-muted); }
.auth-input:focus { color: var(--auth-text-primary); }
.auth-password-toggle { padding: var(--auth-spacing-sm) var(--auth-spacing-md); background: none; border: none; cursor: pointer; font-size: 1.125rem; color: var(--auth-text-muted); transition: var(--auth-transition); border-radius: var(--auth-radius-sm); margin-right: var(--auth-spacing-xs); }
.auth-password-toggle:hover { color: var(--auth-text-primary); background: var(--auth-bg-tertiary); }
.auth-error-text { color: var(--auth-error); font-size: 0.875rem; font-weight: 500; margin-top: var(--auth-spacing-xs); display: flex; align-items: center; gap: var(--auth-spacing-xs); }
.auth-error-text::before { content: "⚠️"; font-size: 0.75rem; }
.auth-password-requirements { background: var(--auth-bg-secondary); padding: var(--auth-spacing-md); border-radius: var(--auth-radius-md); border-left: 4px solid var(--auth-primary); }
.auth-password-requirements small { color: var(--auth-text-secondary); font-size: 0.8rem; line-height: 1.4; }
.auth-submit-button { background: linear-gradient(135deg, var(--auth-primary), var(--auth-primary-hover)); color: white; border: none; padding: var(--auth-spacing-lg) var(--auth-spacing-xl); border-radius: var(--auth-radius-lg); font-size: 1rem; font-weight: 600; cursor: pointer; transition: var(--auth-transition); display: flex; align-items: center; justify-content: center; gap: var(--auth-spacing-sm); min-height: 52px; position: relative; overflow: hidden; }
.auth-submit-button::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); transition: left 0.5s; }
.auth-submit-button:hover::before { left: 100%; }
.auth-submit-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: var(--auth-shadow-lg); }
.auth-submit-button:active:not(:disabled) { transform: translateY(0); }
.auth-submit-button:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
.auth-submit-button.loading { pointer-events: none; }
.auth-spinner { width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.auth-links { text-align: center; display: flex; flex-direction: column; align-items: center; gap: var(--auth-spacing-md); color: var(--auth-text-secondary); font-size: 0.9rem; }
.auth-divider { display: flex; align-items: center; gap: var(--auth-spacing-md); width: 100%; margin: var(--auth-spacing-sm) 0; }
.auth-divider::before, .auth-divider::after { content: ''; flex: 1; height: 1px; background: var(--auth-border); }
.auth-divider span { color: var(--auth-text-muted); font-size: 0.875rem; font-weight: 500; }
.auth-link-button { background: none; border: none; color: var(--auth-primary); cursor: pointer; font-size: inherit; font-weight: 600; text-decoration: none; transition: var(--auth-transition); padding: var(--auth-spacing-xs) var(--auth-spacing-sm); border-radius: var(--auth-radius-sm); }
.auth-link-button:hover:not(:disabled) { color: var(--auth-primary-hover); background: var(--auth-primary-light); }
.auth-link-button.secondary { background: var(--auth-bg-secondary); color: var(--auth-text-primary); padding: var(--auth-spacing-md) var(--auth-spacing-lg); border-radius: var(--auth-radius-md); border: 1px solid var(--auth-border); font-weight: 500; }
.auth-link-button.secondary:hover:not(:disabled) { background: var(--auth-bg-tertiary); border-color: var(--auth-border-focus); }
.auth-link-button:disabled { opacity: 0.5; cursor: not-allowed; }
.auth-success-message, .auth-error-message { margin-bottom: var(--auth-spacing-lg); padding: var(--auth-spacing-md) var(--auth-spacing-lg); border-radius: var(--auth-radius-lg); display: flex; align-items: center; gap: var(--auth-spacing-sm); font-weight: 500; animation: slideDown 0.3s ease-out; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
.auth-success-message { background: var(--auth-primary-light); color: var(--auth-success); border: 1px solid rgba(99, 102, 241, 0.2); }
.auth-error-message { background: rgba(239, 68, 68, 0.1); color: var(--auth-error); border: 1px solid rgba(239, 68, 68, 0.2); }
.auth-success-icon, .auth-error-icon { font-size: 1.125rem; flex-shrink: 0; }
@media (max-width: 768px) { .auth-wrapper { padding: var(--auth-spacing-sm); align-items: flex-start; padding-top: var(--auth-spacing-xl); } .auth-content { max-width: 100%; } .auth-container { padding: var(--auth-spacing-xl) var(--auth-spacing-lg); } .auth-header h2 { font-size: 1.5rem; } .auth-app-title { font-size: 1.25rem; } .auth-logo-icon { font-size: 2rem; } .auth-input { padding: var(--auth-spacing-md); } .auth-submit-button { padding: var(--auth-spacing-md) var(--auth-spacing-lg); } .auth-links { gap: var(--auth-spacing-sm); } }
@media (max-width: 480px) { .auth-wrapper { padding: var(--auth-spacing-xs); padding-top: var(--auth-spacing-lg); } .auth-container { padding: var(--auth-spacing-lg) var(--auth-spacing-md); } .auth-header { margin-bottom: var(--auth-spacing-lg); } .auth-form { gap: var(--auth-spacing-md); } .auth-input-wrapper { border-radius: var(--auth-radius-md); } .auth-submit-button { border-radius: var(--auth-radius-md); min-height: 48px; } }
@media (prefers-reduced-motion: reduce) { * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; } }
.auth-input:focus, .auth-submit-button:focus, .auth-link-button:focus, .auth-password-toggle:focus { outline: 2px solid var(--auth-primary); outline-offset: 2px; }
@media print { .auth-wrapper { background: white; } .auth-background, .auth-background-pattern, .auth-background-overlay { display: none; } .auth-form-container { box-shadow: none; border: 1px solid #ccc; } }

/* =================================================================================================
   Responsive Design
   ================================================================================================= */

/* ... other rules ... */

@media (max-width: 768px) {
  /* ... other mobile rules ... */

  /* NEW: Add styles for the mobile view toggle bar */
  .mobile-view-toggle-bar {
    display: flex; /* This will be hidden on desktop as its container is mobile-only */
    margin-bottom: var(--spacing-md);
    flex-shrink: 0;
  }
  
  .mobile-view-toggle-bar .btn-secondary {
    width: 100%;
    font-size: var(--font-size-sm);
    min-height: 40px;
    padding: var(--spacing-sm);
    justify-content: center;
  }
}

/* ... rest of the file ... */

@media (max-width: 640px) {
  .story-text {
    font-size: var(--font-size-sm); /* 0.875rem */
  }
}


@media (max-width: 768px) {
  /* Reduce height and padding for all main action buttons on mobile */
  .new-story-btn,
  .btn-primary,
  .btn-secondary,
  .btn-create-story,
  .btn-update-audio,
  .btn-regenerate,
  .header-btn {
    min-height: 32px !important;
    height: 32px !important;
    padding: 6px 12px !important;
    font-size: var(--font-size-sm) !important;
  }

  /* Ensure main content and story area are scrollable and visible */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }
  .storyteller-app {
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .app-main {
    flex: 1 1 auto;
    overflow-y: auto;
  }
  .story-content.scrollable {
    flex: 1 1 auto;
    min-height: 0;
    overflow-y: auto;
  }
}


